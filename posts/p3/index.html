<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Fast sub-tree containment checks &#183; Blog</title><link rel=prev href=/posts/p2/><meta name=description content="MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['$$','$$'], ['\[','\]']], processEscapes: true, processEnvironments: true, skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'], TeX: { equationNumbers: { autoNumber: &#34;AMS&#34; }, extensions: [&#34;AMSmath.js&#34;, &#34;AMSsymbols.js&#34;] } } });  MathJax.Hub.Queue(function() { // Fix  tags after MathJax finishes running. This is a // hack to overcome a shortcoming of Markdown. Discussion at // https://github.com/mojombo/jekyll/issues/199 var all = MathJax.Hub.getAllJax(), i; for(i = 0; i There’s a problem on leetcode called &amp;#34;Subtree of Another tree&amp;#34;."><meta name=keywords content="algorithms,data-structures"><meta property="og:title" content="Fast sub-tree containment checks"><meta property="og:description" content="MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['$$','$$'], ['\[','\]']], processEscapes: true, processEnvironments: true, skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'], TeX: { equationNumbers: { autoNumber: &#34;AMS&#34; }, extensions: [&#34;AMSmath.js&#34;, &#34;AMSsymbols.js&#34;] } } });  MathJax.Hub.Queue(function() { // Fix  tags after MathJax finishes running. This is a // hack to overcome a shortcoming of Markdown. Discussion at // https://github.com/mojombo/jekyll/issues/199 var all = MathJax.Hub.getAllJax(), i; for(i = 0; i There’s a problem on leetcode called &amp;#34;Subtree of Another tree&amp;#34;."><meta property="article:published_time" content="2021-02-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-02-21T00:00:00+00:00"><meta property="og:site_name" content="Blog"><meta property="article:section" content="posts"><meta property="article:tag" content="algorithms"><meta property="article:tag" content="data-structures"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fast sub-tree containment checks"><meta name=twitter:description content="MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['$$','$$'], ['\[','\]']], processEscapes: true, processEnvironments: true, skipTags: ['script', 'noscript', …"><meta name=generator content="Hugo 0.79.1"><link rel=stylesheet href=/css/site.min.72989e8586a2239ea67ac4abbdb14c93dda32429d05c83e1eb621be0d97d1924.css integrity="sha256-cpiehYaiI56mesSrvbFMk92jJCnQXIPh62Ib4Nl9GSQ="></head><body class=article><header class=header><nav class=navbar><div class=navbar-brand><a class=navbar-item href=/>Blog</a>
<button class=navbar-burger data-target=topbar-nav>
<span></span><span></span><span></span></button></div><div id=topbar-nav class=navbar-menu><div class=navbar-end><a class=navbar-item href=/services/ title=Services>Services</a>
<a class=navbar-item href=/supported-tech/ title="Supported Technologies">Supported Technologies</a></div></div></nav></header><div class=body><div class=nav-container><aside class=nav><div class=panels><div class="nav-panel-menu is-active" data-panel=menu><nav class=nav-menu><h3 class=title><a href=/>Blog</a></h3><ul class=nav-list><li class=nav-item data-depth=0><button class=nav-item-toggle></button>
<a class=nav-link href=/posts/>Posts</a><ul class=nav-list><li class="nav-item is-current-page" data-depth=1><a class=nav-link href=/posts/p3/>Fast sub-tree containment checks</a></li><li class=nav-item data-depth=1><a class=nav-link href=/posts/p2/>Non-standard solutions to some technical problems</a></li><li class=nav-item data-depth=1><a class=nav-link href=/posts/p1/>Setting up the new blog</a></li></ul></li><li class=nav-item data-depth=0><a class=nav-link href=/services/>Services</a></li><li class=nav-item data-depth=0><a class=nav-link href=/supported-tech/>Supported Technologies</a></li></ul></nav></div><div class=nav-panel-explore data-panel=explore style=display:none><div class=context><span class=title></span><span class=version></span></div></div></div></aside></div><main class=article><div class=toolbar role=navigation><button class=nav-toggle></button>
<a href=/ class=home-link></a><nav class=breadcrumbs aria-label=breadcrumbs><ul><li><a href=/>Blog</a></li><li><a href=/posts/>Posts</a></li><li>Fast sub-tree containment checks</li></ul></nav></div><div class=content><article class=doc><h1 class=page>Fast sub-tree containment checks</h1><div class="openblock is-before-toc"><div class=title>Posted on February 21, 2021
&#183; Tagged with
<a href=/tags/algorithms/>algorithms</a>, <a href=/tags/data-structures/>data-structures</a></div></div><div></div><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script><script type=text/x-mathjax-config>
  MathJax.Hub.Queue(function() {
    // Fix <code> tags after MathJax finishes running. This is a
    // hack to overcome a shortcoming of Markdown. Discussion at
    // https://github.com/mojombo/jekyll/issues/199
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script><div class=paragraph><p>There’s a problem on leetcode called <a href=https://leetcode.com/problems/subtree-of-another-tree/>"Subtree of Another tree"</a>.
It requires to check whether one binary tree is a subtree of another binary tree.</p></div><div class=paragraph><p>There are two official solutions presented, one involving a <a href=https://en.wikipedia.org/wiki/Tree_traversal#Pre-order>pre-order traversal</a> which is
$O(m^2 + n^2+m\cdot n)$ and another one
that checks does a traversal for every subtree of the bigger tree, and checks if it’s equal
to the smaller tree, element-by-element and this is $O(m\cdot n)$.</p></div><div class=paragraph><p>It’s possible to write a different solution using
<a href=https://en.wikipedia.org/wiki/Merkle_tree>Merkle trees</a> that has
$O(m+n)$ <a href=https://en.wikipedia.org/wiki/Time_complexity>time complexity</a> (if we consider $O(1)$ the time to compute one hash).</p></div><div class=paragraph><p>The Merkle trees can be computed
<a href=https://en.wikipedia.org/wiki/Top-down_and_bottom-up_design>bottom-up</a>
and the hashes for each node can be stored. Then the containment check
only requires checking if a certain hash is present in a dictionary.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>This will pass all the tests, but if we want to avoid false positives
completely, once a hash match is found we need to do one tree-equality check.
Merkle trees can generate <a href=https://stackoverflow.com/a/14197504/827519>false positives</a>
because <a href=https://en.wikipedia.org/wiki/Collision_(computer_science)>hash collisions</a> are possible.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="pygments highlight" style=background:#f8f8f8><code data-lang=python><table class=linenotable><tbody><tr><td class=linenos><div class=linenodiv><pre><span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 1</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 2</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 3</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 4</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 5</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 6</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 7</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 8</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px> 9</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>10</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>11</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>12</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>13</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>14</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>15</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>16</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>17</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>18</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>19</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>20</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>21</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>22</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>23</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>24</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>25</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>26</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>27</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>28</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>29</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>30</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>31</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>32</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>33</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>34</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>35</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>36</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>37</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>38</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>39</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>40</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>41</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>42</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>43</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>44</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>45</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>46</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>47</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>48</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>49</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>50</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>51</span>
<span style=color:inherit;background-color:transparent;padding-left:5px;padding-right:5px>52</span></pre></div></td><td class=code><pre><span></span> <span style=color:#408080;font-style:italic>#!/usr/bin/python3</span>

 <span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>hashlib</span>

 <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>HashUtil</span>:
     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>__init__</span>(<span style=color:green>self</span>):
         <span style=color:green>self</span><span style=color:#666>.</span>m <span style=color:#666>=</span> hashlib<span style=color:#666>.</span>md5()

     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>add_int</span>(<span style=color:green>self</span>,val):
         <span style=color:green>self</span><span style=color:#666>.</span>m<span style=color:#666>.</span>update(<span style=color:green>str</span>(val)<span style=color:#666>.</span>encode(<span style=color:#ba2121>&#39;ASCII&#39;</span>))

     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>add_str</span>(<span style=color:green>self</span>,val):
         <span style=color:green>self</span><span style=color:#666>.</span>m<span style=color:#666>.</span>update(val<span style=color:#666>.</span>encode(<span style=color:#ba2121>&#39;ASCII&#39;</span>))

     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>get_hash</span>(<span style=color:green>self</span>):
         <span style=color:green;font-weight:700>return</span> <span style=color:green>self</span><span style=color:#666>.</span>m<span style=color:#666>.</span>hexdigest()

 <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>MerkleTree</span>:
     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>__init__</span>(<span style=color:green>self</span>, x):
         <span style=color:green>self</span><span style=color:#666>.</span>hashes <span style=color:#666>=</span> {}
         <span style=color:green>self</span><span style=color:#666>.</span>build(x)

     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>contains</span>(<span style=color:green>self</span>, H):
         <span style=color:green;font-weight:700>return</span> H <span style=color:#a2f;font-weight:700>in</span> <span style=color:green>self</span><span style=color:#666>.</span>hashes

     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>build</span>(<span style=color:green>self</span>, x):
         h <span style=color:#666>=</span> HashUtil()

         <span style=color:green;font-weight:700>if</span> <span style=color:#a2f;font-weight:700>not</span> x<span style=color:#666>.</span>left <span style=color:#a2f;font-weight:700>and</span> <span style=color:#a2f;font-weight:700>not</span> x<span style=color:#666>.</span>right:
             h<span style=color:#666>.</span>add_int(x<span style=color:#666>.</span>val)
             x<span style=color:#666>.</span>hash <span style=color:#666>=</span> h<span style=color:#666>.</span>get_hash()
             <span style=color:green>self</span><span style=color:#666>.</span>hashes[x<span style=color:#666>.</span>hash]<span style=color:#666>=1</span>
             <span style=color:green;font-weight:700>return</span> x<span style=color:#666>.</span>hash

         h<span style=color:#666>.</span>add_int(x<span style=color:#666>.</span>val)

         <span style=color:green;font-weight:700>if</span> x<span style=color:#666>.</span>left:
             h<span style=color:#666>.</span>add_str(<span style=color:#ba2121>&#34;L&#34;</span><span style=color:#666>+</span><span style=color:green>self</span><span style=color:#666>.</span>build(x<span style=color:#666>.</span>left))

         <span style=color:green;font-weight:700>if</span> x<span style=color:#666>.</span>right:
             h<span style=color:#666>.</span>add_str(<span style=color:#ba2121>&#34;R&#34;</span><span style=color:#666>+</span><span style=color:green>self</span><span style=color:#666>.</span>build(x<span style=color:#666>.</span>right))

         x<span style=color:#666>.</span>hash <span style=color:#666>=</span> h<span style=color:#666>.</span>get_hash()
         <span style=color:green>self</span><span style=color:#666>.</span>hashes[x<span style=color:#666>.</span>hash]<span style=color:#666>=1</span>
         <span style=color:green;font-weight:700>return</span> x<span style=color:#666>.</span>hash

 <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Solution</span>:
     <span style=color:green;font-weight:700>def</span> <span style=color:#00f>isSubtree</span>(<span style=color:green>self</span>, s: TreeNode, t: TreeNode) <span style=color:#666>-&gt;</span> <span style=color:green>bool</span>:
         M_s <span style=color:#666>=</span> MerkleTree(s)
         M_t <span style=color:#666>=</span> MerkleTree(t)

         <span style=color:green;font-weight:700>return</span> M_s<span style=color:#666>.</span>contains(t<span style=color:#666>.</span>hash)
</pre></td></tr></tbody></table></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>If you liked this article and would like to discuss more about how
S.C. MAGNA SOFTWARE S.R.L can help you optimize and fine-tune slow
code and solve <a href=https://wsdookadr.github.io/services/>production issues</a>, feel free to
<a href=https://calendly.com/stefan-petrea/30min>book a 30-minute call</a> with me so we can get to know each other and discuss
a future collaboration.</td></tr></tbody></table></div><nav class=pagination><span class=prev><a href=/posts/p2/>Non-standard solutions to some technical problems</a></span></nav></article><aside class="toc sidebar" data-title data-levels=2><div class=toc-menu></div></aside></div></main></div><footer class=footer><p>This page was built with <a href=https://gohugo.io/>Hugo 0.79.1</a> using the <a href=https://github.com/basil/antora-default-ui-hugo-theme>Hugo port</a> of the <a href=https://gitlab.com/antora/antora-ui-default>Antora default UI</a>. The source code for this UI is licensed under the terms of the <a href=https://www.mozilla.org/en-US/MPL/2.0/>Mozilla Public License, Version 2.0</a> (MPL-2.0).</p></footer><div id=copy-to-clipboard style=display:none data-svg=/img/octicons-16.svg></div><script src=/js/site.min.da461a26436bc4ba84975879f2d7f90a593245b694bbea075400ef251e78b2e0.js integrity="sha256-2kYaJkNrxLqEl1h58tf5ClkyRbaUu+oHVADvJR54suA="></script><script src=/js/vendor/highlight.pack.79c21a0aa45cc5756c18c07f0cf37be9ad1e1b728f6f0e6b210c3913cfef592f.js integrity="sha256-ecIaCqRcxXVsGMB/DPN76a0eG3KPbw5rIQw5E8/vWS8="></script><script>;[].slice.call(document.querySelectorAll('pre code.hljs')).forEach(function(node){hljs.highlightBlock(node)})</script></body></html>